<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Notification Web App - Fixed</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .notification-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active { background-color: #10B981; }
        .status-inactive { background-color: #EF4444; }
        .status-waiting { background-color: #F59E0B; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-bell text-blue-500 mr-2"></i>
                    Random Notification App
                </h1>
                <p class="text-gray-600">Get random notifications at customizable intervals</p>
            </div>

            <!-- Status Section -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="status-indicator status-inactive" id="statusIndicator"></span>
                        <span class="font-semibold text-gray-700">Status: </span>
                        <span id="statusText" class="ml-2 text-gray-600">Stopped</span>
                    </div>
                    <div class="text-sm text-gray-500" id="nextNotification"></div>
                </div>
                <div class="mt-2">
                    <div id="permissionStatus" class="text-sm"></div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- Permission & Controls -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-blue-800 mb-3">
                        <i class="fas fa-key mr-2"></i>Controls
                    </h3>
                    
                    <button id="requestPermissionBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg mb-3 transition-colors duration-200">
                        <i class="fas fa-unlock mr-2"></i>Enable Notifications
                    </button>
                    
                    <div class="flex gap-2">
                        <button id="startBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-play mr-2"></i>Start
                        </button>
                        <button id="stopBtn" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-stop mr-2"></i>Stop
                        </button>
                    </div>
                </div>

                <!-- Time Settings -->
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-green-800 mb-3">
                        <i class="fas fa-clock mr-2"></i>Timing Settings
                    </h3>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Minimum Interval (seconds)
                            </label>
                            <input type="number" id="minInterval" value="10" min="5" max="3600" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Maximum Interval (seconds)
                            </label>
                            <input type="number" id="maxInterval" value="60" min="10" max="7200" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Section -->
            <div class="bg-purple-50 rounded-lg p-4 mb-6">
                <h3 class="text-lg font-semibold text-purple-800 mb-3">
                    <i class="fas fa-message mr-2"></i>Notification Messages
                </h3>
                
                <div class="flex gap-2 mb-3">
                    <input type="text" id="newMessage" placeholder="Enter new notification message..." 
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <button id="addMessageBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition-colors duration-200">
                        <i class="fas fa-plus mr-2"></i>Add
                    </button>
                </div>
                
                <div id="messagesList" class="space-y-2 max-h-40 overflow-y-auto"></div>
            </div>

            <!-- Statistics -->
            <div class="bg-yellow-50 rounded-lg p-4">
                <h3 class="text-lg font-semibold text-yellow-800 mb-3">
                    <i class="fas fa-chart-line mr-2"></i>Statistics
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-yellow-600" id="totalNotifications">0</div>
                        <div class="text-sm text-gray-600">Total Sent</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-yellow-600" id="sessionTime">0:00</div>
                        <div class="text-sm text-gray-600">Session Time</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-yellow-600" id="avgInterval">0</div>
                        <div class="text-sm text-gray-600">Avg Interval (s)</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-yellow-600" id="messagesCount">5</div>
                        <div class="text-sm text-gray-600">Messages</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error/Info Messages -->
        <div id="alertContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>
    </div>

    <script>
        class NotificationApp {
            constructor() {
                this.isRunning = false;
                this.timeoutId = null;
                this.messages = [
                    "Time for a quick break! üßò‚Äç‚ôÇÔ∏è",
                    "Stay hydrated! Drink some water üíß",
                    "Take a deep breath and relax üå∏",
                    "Stretch your body for better health ü§∏‚Äç‚ôÄÔ∏è",
                    "Remember to check your posture üìè"
                ];
                this.stats = {
                    totalNotifications: 0,
                    sessionStartTime: null,
                    intervals: []
                };
                
                this.elements = {
                    statusIndicator: document.getElementById('statusIndicator'),
                    statusText: document.getElementById('statusText'),
                    nextNotification: document.getElementById('nextNotification'),
                    permissionStatus: document.getElementById('permissionStatus'),
                    requestPermissionBtn: document.getElementById('requestPermissionBtn'),
                    startBtn: document.getElementById('startBtn'),
                    stopBtn: document.getElementById('stopBtn'),
                    minInterval: document.getElementById('minInterval'),
                    maxInterval: document.getElementById('maxInterval'),
                    newMessage: document.getElementById('newMessage'),
                    addMessageBtn: document.getElementById('addMessageBtn'),
                    messagesList: document.getElementById('messagesList'),
                    totalNotifications: document.getElementById('totalNotifications'),
                    sessionTime: document.getElementById('sessionTime'),
                    avgInterval: document.getElementById('avgInterval'),
                    messagesCount: document.getElementById('messagesCount')
                };

                this.init();
            }

            init() {
                this.checkNotificationSupport();
                this.loadSavedData();
                this.updateUI();
                this.bindEvents();
                this.renderMessages();
                this.updateStats();
                
                // Start session timer
                setInterval(() => this.updateSessionTime(), 1000);
            }

            checkNotificationSupport() {
                if (!("Notification" in window)) {
                    this.showAlert("Your browser doesn't support notifications", "error");
                    this.elements.requestPermissionBtn.disabled = true;
                    this.elements.permissionStatus.innerHTML = 
                        '<span class="text-red-600"><i class="fas fa-times mr-1"></i>Not supported</span>';
                    return false;
                }
                
                this.updatePermissionStatus();
                return true;
            }

            async requestPermission() {
                try {
                    if (!("Notification" in window)) {
                        throw new Error("Notifications not supported");
                    }

                    let permission = Notification.permission;
                    
                    if (permission === "default") {
                        permission = await Notification.requestPermission();
                    }
                    
                    if (permission === "granted") {
                        this.showAlert("Notifications enabled successfully!", "success");
                        this.testNotification();
                    } else if (permission === "denied") {
                        this.showAlert("Notifications blocked. Please enable them in browser settings.", "error");
                    }
                    
                    this.updatePermissionStatus();
                    this.updateUI();
                    
                } catch (error) {
                    console.error("Permission request error:", error);
                    this.showAlert("Failed to request notification permission: " + error.message, "error");
                }
            }

            testNotification() {
                try {
                    new Notification("üéâ Notifications Enabled!", {
                        body: "You'll now receive random notifications as configured.",
                        icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234F46E5'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/></svg>",
                        tag: "test-notification"
                    });
                } catch (error) {
                    console.error("Test notification error:", error);
                }
            }

            updatePermissionStatus() {
                const permission = Notification.permission;
                const statusElement = this.elements.permissionStatus;
                
                switch (permission) {
                    case "granted":
                        statusElement.innerHTML = 
                            '<span class="text-green-600"><i class="fas fa-check mr-1"></i>Notifications enabled</span>';
                        this.elements.requestPermissionBtn.textContent = "‚úì Enabled";
                        this.elements.requestPermissionBtn.disabled = true;
                        this.elements.requestPermissionBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                        this.elements.requestPermissionBtn.classList.add('bg-green-500');
                        break;
                    case "denied":
                        statusElement.innerHTML = 
                            '<span class="text-red-600"><i class="fas fa-times mr-1"></i>Notifications blocked</span>';
                        break;
                    default:
                        statusElement.innerHTML = 
                            '<span class="text-yellow-600"><i class="fas fa-exclamation mr-1"></i>Permission required</span>';
                }
            }

            updateUI() {
                const hasPermission = Notification.permission === "granted";
                
                this.elements.startBtn.disabled = !hasPermission || this.isRunning;
                this.elements.stopBtn.disabled = !this.isRunning;
                
                if (this.isRunning) {
                    this.elements.statusIndicator.className = "status-indicator status-active";
                    this.elements.statusText.textContent = "Active";
                } else {
                    this.elements.statusIndicator.className = "status-indicator status-inactive";
                    this.elements.statusText.textContent = "Stopped";
                    this.elements.nextNotification.textContent = "";
                }
            }

            start() {
                if (!this.isRunning && Notification.permission === "granted") {
                    this.isRunning = true;
                    this.stats.sessionStartTime = Date.now();
                    this.scheduleNextNotification();
                    this.updateUI();
                    this.showAlert("Notifications started!", "success");
                }
            }

            stop() {
                if (this.isRunning) {
                    this.isRunning = false;
                    if (this.timeoutId) {
                        clearTimeout(this.timeoutId);
                        this.timeoutId = null;
                    }
                    this.updateUI();
                    this.showAlert("Notifications stopped", "info");
                }
            }

            scheduleNextNotification() {
                if (!this.isRunning) return;

                const minInterval = parseInt(this.elements.minInterval.value) * 1000;
                const maxInterval = parseInt(this.elements.maxInterval.value) * 1000;
                
                if (minInterval >= maxInterval) {
                    this.showAlert("Minimum interval must be less than maximum interval", "error");
                    this.stop();
                    return;
                }

                const randomInterval = Math.random() * (maxInterval - minInterval) + minInterval;
                const nextTime = new Date(Date.now() + randomInterval);
                
                this.elements.nextNotification.textContent = 
                    `Next: ${nextTime.toLocaleTimeString()}`;
                
                this.stats.intervals.push(randomInterval / 1000);

                this.timeoutId = setTimeout(() => {
                    this.sendNotification();
                    this.scheduleNextNotification();
                }, randomInterval);
            }

            sendNotification() {
                if (this.messages.length === 0) {
                    this.showAlert("No messages available for notifications", "warning");
                    return;
                }

                try {
                    const randomMessage = this.messages[Math.floor(Math.random() * this.messages.length)];
                    
                    const notification = new Notification("Random Reminder", {
                        body: randomMessage,
                        icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234F46E5'><path d='M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z'/></svg>",
                        tag: "random-notification",
                        requireInteraction: false
                    });

                    // Auto-close notification after 5 seconds
                    setTimeout(() => {
                        notification.close();
                    }, 5000);

                    this.stats.totalNotifications++;
                    this.updateStats();
                    
                } catch (error) {
                    console.error("Notification error:", error);
                    this.showAlert("Failed to send notification: " + error.message, "error");
                }
            }

            addMessage() {
                const message = this.elements.newMessage.value.trim();
                if (message && !this.messages.includes(message)) {
                    this.messages.push(message);
                    this.elements.newMessage.value = "";
                    this.renderMessages();
                    this.updateStats();
                    this.saveData();
                    this.showAlert("Message added successfully!", "success");
                } else if (this.messages.includes(message)) {
                    this.showAlert("Message already exists", "warning");
                } else {
                    this.showAlert("Please enter a valid message", "warning");
                }
            }

            removeMessage(index) {
                if (index >= 0 && index < this.messages.length) {
                    this.messages.splice(index, 1);
                    this.renderMessages();
                    this.updateStats();
                    this.saveData();
                    this.showAlert("Message removed", "info");
                }
            }

            renderMessages() {
                const container = this.elements.messagesList;
                container.innerHTML = "";

                this.messages.forEach((message, index) => {
                    const messageDiv = document.createElement("div");
                    messageDiv.className = "flex items-center justify-between bg-white p-3 rounded-md border slide-in";
                    messageDiv.innerHTML = `
                        <span class="flex-1 text-gray-700">${this.escapeHtml(message)}</span>
                        <button onclick="app.removeMessage(${index})" 
                                class="text-red-500 hover:text-red-700 ml-2 p-1 rounded">
                            <i class="fas fa-trash text-sm"></i>
    </button>
